name: WINDOWS_11_1TB_EXACTO_RUSTDESK
on: 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: ðŸ’¾ 1. CREAR DISCO DE 1TB EXACTO (DINAMICO)
        shell: powershell
        run: |
          Write-Host "[*] Calculando tamaÃ±o para 1TB exacto..." -ForegroundColor Cyan
          # Usamos 1025GB para forzar a Windows a mostrar 1.0TB y no 0.99TB
          $diskPath = "C:\Disco1TB.vhdx"
          New-VHD -Path $diskPath -SizeBytes 1025GB -Dynamic
          
          Write-Host "[*] Montando y formateando..." -ForegroundColor Yellow
          $vhd = Mount-VHD -Path $diskPath -PassThru
          $disk = $vhd | Get-Disk
          Initialize-Disk -Number $disk.Number -PartitionStyle GPT
          $partition = New-Partition -DiskNumber $disk.Number -UseMaximumSize -AssignDriveLetter
          # Formateo rÃ¡pido para no ocupar espacio real en el host
          Format-Volume -DriveLetter $partition.DriveLetter -FileSystem NTFS -NewFileSystemLabel "Disco" -Confirm:$false
          
          Write-Host "[+] Disco de 1.0 TB creado exitosamente." -ForegroundColor Green

      - name: ðŸ”‘ 2. INSTALAR RUSTDESK
        shell: powershell
        run: |
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 15
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          Write-Host "################################################" -ForegroundColor Yellow
          Write-Host "ID: $id | CLAVE: Bullet123" -ForegroundColor Green
          Write-Host "################################################" -ForegroundColor Yellow

      - name: ðŸ“¸ 3. CAPTURA A CATBOX
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          Start-Process "C:\Program Files\RustDesk\rustdesk.exe"
          Start-Sleep -Seconds 5
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap($screen.Width, $screen.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\id_screenshot.png")
          
          $link = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\id_screenshot.png" https://catbox.moe/user/api.php
          Write-Host "LINK CAPTURA: $link" -ForegroundColor Cyan

      - name: ðŸ”„ MANTENER VIVO
        shell: powershell
        run: |
          while($true) { Start-Sleep -Seconds 60 }
          
