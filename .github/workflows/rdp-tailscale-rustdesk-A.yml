name: WIN11_RTX4090_REALISM_V3
on: 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: 驕뮖잺 1. MODIFICACI칍N DE KERNEL (NIVEL EXPERTO)
        shell: powershell
        run: |
          Write-Host "[*] INICIANDO PROTOCOLO DE SIMULACI칍N DE HARDWARE..." -ForegroundColor Cyan

          # --- A. CPU (Ryzen 9 7950X3D) ---
          $cpuPath = "HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor"
          try {
              Get-ChildItem -Path $cpuPath -ErrorAction SilentlyContinue | ForEach-Object {
                  Set-ItemProperty -Path $_.PSPath -Name "ProcessorNameString" -Value "AMD Ryzen 9 7950X3D 16-Core Processor" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "VendorIdentifier" -Value "AuthenticAMD" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "FeatureSet" -Value 0 -Force
              }
              Write-Host "[OK] CPU: Identidad AMD establecida." -ForegroundColor Green
          } catch {}

          # --- B. GPU (SPOOFING AGRESIVO DE CLASE Y SERVICIO) ---
          $videoClass = "HKLM:\SYSTEM\CurrentControlSet\Control\Class\{4d36e968-e325-11ce-bfc1-08002be10318}"
          
          try {
              Get-ChildItem -Path $videoClass -ErrorAction SilentlyContinue | ForEach-Object {
                  # Detectamos si es el driver activo de Microsoft/Hyper-V
                  $desc = ($_ | Get-ItemProperty -Name "DriverDesc" -ErrorAction SilentlyContinue).DriverDesc
                  if ($desc -match "Microsoft" -or $desc -match "Hyper-V" -or $desc -match "Display") {
                      
                      Write-Host "[*] Objetivo encontrado: $desc. Inyectando Payload NVIDIA..." -ForegroundColor Yellow

                      # 1. EL NOMBRE PRINCIPAL (LA SOLUCI칍N A TU PROBLEMA)
                      # DxDiag prefiere 'DriverDesc' si 'ProviderName' no es Microsoft.
                      Set-ItemProperty -Path $_.PSPath -Name "DriverDesc" -Value "NVIDIA GeForce RTX 4090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "ProviderName" -Value "NVIDIA" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "DriverVersion" -Value "31.0.15.3713" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "DriverDate" -Value "2-24-2025" -Force
                      
                      # 2. SIMULACI칍N DE ID DE HARDWARE (REAL RTX 4090 ID)
                      # Esto enga침a a las herramientas para que crean que el ID PCI es de NVIDIA
                      Set-ItemProperty -Path $_.PSPath -Name "MatchingDeviceId" -Value "PCI\VEN_10DE&DEV_2684" -Force
                      
                      # 3. DETALLES DEL CHIP
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.AdapterString" -Value "NVIDIA GeForce RTX 4090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.ChipType" -Value "NVIDIA GeForce RTX 4090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.DacType" -Value "Integrated RAMDAC" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.BiosString" -Value "Version 95.02.18.00.01" -Force

                      # 4. VRAM MAESTRA (24GB)
                      # Usamos QWORD (64-bit) para que 'Display Memory' no salga en 0 MB
                      # 24GB = 25769803776 bytes
                      New-ItemProperty -Path $_.PSPath -Name "HardwareInformation.QwMemorySize" -Value 25769803776 -PropertyType QWord -Force -ErrorAction SilentlyContinue
                      New-ItemProperty -Path $_.PSPath -Name "HardwareInformation.MemorySize" -Value 25769803776 -PropertyType QWord -Force -ErrorAction SilentlyContinue
                  }
              }
              Write-Host "[OK] GPU: RTX 4090 Inyectada con exito." -ForegroundColor Green
          } catch { Write-Host "[!] Error en GPU Spoof" -ForegroundColor Red }

          # --- C. SYSTEM INFO (ELIMINAR 'VIRTUAL MACHINE') ---
          # Atacamos SystemInformation en ControlSet para borrar el rastro de VM
          $sysInfoPaths = @(
            "HKLM:\SYSTEM\CurrentControlSet\Control\SystemInformation",
            "HKLM:\HARDWARE\DESCRIPTION\System\BIOS"
          )

          foreach ($path in $sysInfoPaths) {
              try {
                  if (!(Test-Path $path)) { New-Item -Path $path -Force | Out-Null }
                  Set-ItemProperty -Path $path -Name "SystemManufacturer" -Value "ASUS" -Force -ErrorAction SilentlyContinue
                  Set-ItemProperty -Path $path -Name "SystemProductName" -Value "ROG CROSSHAIR X670E HERO" -Force -ErrorAction SilentlyContinue
                  Set-ItemProperty -Path $path -Name "BaseBoardManufacturer" -Value "ASUSTeK COMPUTER INC." -Force -ErrorAction SilentlyContinue
                  Set-ItemProperty -Path $path -Name "BIOSVendor" -Value "American Megatrends Inc." -Force -ErrorAction SilentlyContinue
                  Set-ItemProperty -Path $path -Name "BIOSReleaseDate" -Value "09/22/2025" -Force -ErrorAction SilentlyContinue
              } catch {}
          }
          Write-Host "[OK] BIOS: Identidad ASUS ROG establecida." -ForegroundColor Green

      - name: 游쀯릖 2. CONFIGURACI칍N ESPA칌OLA (OPTIMIZADA)
        shell: powershell
        run: |
          # Cambiamos la cultura y la zona horaria.
          # NO instalamos el paquete de idioma completo porque tarda 15 min y congela el runner.
          # Esto pondr치 fechas, monedas y formatos en Espa침ol de Espa침a.
          Set-Culture es-ES
          Set-WinSystemLocale es-ES
          Set-TimeZone -Id "Romance Standard Time"
          Set-WinHomeLocation -GeoId 217
          Write-Host "[OK] Locale configurado a es-ES (Espa침a)."

      - name: 游 3. DISCO GAMING 1TB
        shell: powershell
        run: |
          New-VHD -Path "C:\Games_Storage.vhdx" -SizeBytes 1025GB -Dynamic
          $vhd = Mount-VHD -Path "C:\Games_Storage.vhdx" -PassThru
          $disk = $vhd | Get-Disk
          Initialize-Disk -Number $disk.Number -PartitionStyle GPT
          $partition = New-Partition -DiskNumber $disk.Number -UseMaximumSize -AssignDriveLetter
          Format-Volume -DriveLetter $partition.DriveLetter -FileSystem NTFS -NewFileSystemLabel "NVMe_Gen5_1TB" -Confirm:$false

      - name: 游댐 4. INSTALAR RUSTDESK
        shell: powershell
        run: |
          Write-Host "[*] Descargando RustDesk..."
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          
          Start-Sleep -Seconds 10
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          
          $id = ""
          for ($i=0; $i -lt 20; $i++) {
              $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
              if ($id) { break }
              Start-Sleep -Seconds 3
          }
          Write-Host "================================================" -ForegroundColor Yellow
          Write-Host " ID DE CONEXION: $id" -ForegroundColor Green
          Write-Host " CONTRASE칌A:     Bullet123" -ForegroundColor Green
          Write-Host "================================================" -ForegroundColor Yellow

      - name: 游닞 5. EVIDENCIA DE SEGURIDAD
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          Start-Sleep -Seconds 2
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap($screen.Width, $screen.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\proof.png")
          
          $link = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\proof.png" https://catbox.moe/user/api.php
          Write-Host "CAPTURA EXITOSA: $link" -ForegroundColor Cyan

      - name: 游댃 BUCLE INFINITO
        shell: powershell
        run: |
          while($true) { Start-Sleep -Seconds 60 }
          
