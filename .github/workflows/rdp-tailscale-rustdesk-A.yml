name: WIN11_RTX_5090_FINAL_EDITION
on: 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: ðŸš€ 1. SPOOFING HARDWARE (RTX 5090 + NVIDIA PROVIDER)
        shell: powershell
        run: |
          Write-Host "[*] INICIANDO PROTOCOLO BLACKWELL 5090..." -ForegroundColor Cyan

          # --- A. GPU SPOOF (RTX 5090) ---
          $videoClass = "HKLM:\SYSTEM\CurrentControlSet\Control\Class\{4d36e968-e325-11ce-bfc1-08002be10318}"
          
          try {
              Get-ChildItem -Path $videoClass -ErrorAction SilentlyContinue | ForEach-Object {
                  $desc = ($_ | Get-ItemProperty -Name "DriverDesc" -ErrorAction SilentlyContinue).DriverDesc
                  
                  if ($desc -match "Microsoft" -or $desc -match "Hyper-V" -or $desc -match "Display") {
                      
                      Write-Host "[+] Modificando adaptador: $desc" -ForegroundColor Yellow

                      # Forzar Proveedor y Descripcion
                      Set-ItemProperty -Path $_.PSPath -Name "DriverDesc" -Value "NVIDIA GeForce RTX 5090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "ProviderName" -Value "NVIDIA" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "MatchingDeviceId" -Value "PCI\VEN_10DE&DEV_2684" -Force
                      
                      # Detalles del Chipset Blackwell
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.AdapterString" -Value "NVIDIA GeForce RTX 5090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.ChipType" -Value "NVIDIA GeForce RTX 5090" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.DacType" -Value "Integrated RAMDAC" -Force
                      Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.BiosString" -Value "Version 96.02.20.00.01" -Force

                      # Inyeccion de 32GB VRAM (QWord para precision de 64 bits)
                      # 32GB = 34359738368 bytes
                      Remove-ItemProperty -Path $_.PSPath -Name "HardwareInformation.QwMemorySize" -ErrorAction SilentlyContinue
                      New-ItemProperty -Path $_.PSPath -Name "HardwareInformation.QwMemorySize" -Value 34359738368 -PropertyType QWord -Force
                      New-ItemProperty -Path $_.PSPath -Name "HardwareInformation.MemorySize" -Value 34359738368 -PropertyType QWord -Force
                  }
              }
          } catch { Write-Host "[!] Error en el acceso al registro de video." -ForegroundColor Red }

          # --- B. CPU SPOOF (RYZEN 9 7950X3D) ---
          try {
              Get-ChildItem -Path "HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor" | ForEach-Object {
                  Set-ItemProperty -Path $_.PSPath -Name "ProcessorNameString" -Value "AMD Ryzen 9 7950X3D 16-Core Processor" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "VendorIdentifier" -Value "AuthenticAMD" -Force
              }
              Write-Host "[OK] CPU e Identidad NVIDIA RTX 5090 establecidas." -ForegroundColor Green
          } catch {}

      - name: ðŸ‡ªðŸ‡¸ 2. CONFIGURACION REGIONAL (ESPANOL)
        shell: powershell
        run: |
          Write-Host "[*] Aplicando configuracion regional es-ES..." -ForegroundColor Yellow
          # No instalamos el pack completo para evitar el estancamiento del Runner
          Set-Culture es-ES
          Set-WinSystemLocale es-ES
          Set-WinHomeLocation -GeoId 217
          Set-TimeZone -Id "Romance Standard Time"
          Write-Host "[OK] Formatos y region configurados a EspaÃ±a."

      - name: ðŸ”‘ 3. ACCESO REMOTO (RUSTDESK)
        shell: powershell
        run: |
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 8
          
          # Configuracion de contraseÃ±a maestra
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          
          $id = ""
          for ($i=0; $i -lt 10; $i++) {
              $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
              if ($id) { break }
              Start-Sleep -Seconds 2
          }
          
          Write-Host "========================================" -ForegroundColor Yellow
          Write-Host "ID RUSTDESK: $id" -ForegroundColor Green
          Write-Host "PASS:        Bullet123" -ForegroundColor Green
          Write-Host "========================================" -ForegroundColor Yellow

      - name: ðŸ“¸ 4. CAPTURA DE PANTALLA (CATBOX)
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap($screen.Width, $screen.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\dxdiag_check.png")
          
          $link = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\dxdiag_check.png" https://catbox.moe/user/api.php
          Write-Host "FOTO DE VERIFICACION: $link" -ForegroundColor Cyan

      - name: ðŸ”„ MANTENER CONEXION ACTIVA
        shell: powershell
        run: |
          Write-Host "[!] Runner activo. No cierres esta ventana." -ForegroundColor Magenta
          while($true) { Start-Sleep -Seconds 60 }
          
