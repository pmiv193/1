name: WINDOWS_11_RUSTDESK_AUTO_GATO
on: 
  workflow_dispatch:
    inputs:
      bot_token:
        description: 'MTQ1NDY1OTI5MDQyMDc0NDIyNQ.GDl9fq.SdHDeRDlwhliK9eK2VED9vmlol3h28fJaRm0rA'
        required: true

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: ðŸ”‘ INSTALAR Y CONFIGURAR RUSTDESK
        shell: powershell
        run: |
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 15
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          Write-Host "ID RUSTDESK: $id" -ForegroundColor Green

      - name: ðŸ¤– CLONAR, CONFIGURAR TOKEN Y EJECUTAR
        shell: powershell
        run: |
          $REPO_URL = "https://github.com/pmiv193/gati.git"
          $FOLDER = "C:\Users\Public\gati"
          $TOKEN = "${{ github.event.inputs.bot_token }}"
          
          Write-Host "[*] Clonando repo..." -ForegroundColor Cyan
          git clone $REPO_URL $FOLDER
          cd $FOLDER
          
          Write-Host "[*] Aplicando parche automÃ¡tico al Token..." -ForegroundColor Yellow
          # Este comando busca la parte donde el script pide el token y lo reemplaza por el tuyo
          # Asumiendo que tu cÃ³digo tiene algo como: token = input("...")
          (Get-Content main.py) | ForEach-Object {
              $_ -replace 'input\(.*?\)', "'$TOKEN'"
          } | Set-Content main.py
          
          Write-Host "[*] Instalando requisitos y lanzando..." -ForegroundColor Green
          # Ejecutamos en una nueva ventana para que veas el proceso en RustDesk
          Start-Process python.exe -ArgumentList "main.py" -WorkingDirectory $FOLDER
          
          # Crear lanzador de emergencia en el escritorio
          $DesktopPath = [Environment]::GetFolderPath("Desktop")
          "@echo off`ncd $FOLDER`npython main.py`npause" | Out-File -FilePath "$DesktopPath\REINICIAR_GATO.bat" -Encoding ascii

      - name: ðŸ“¸ CAPTURA ID CATBOX
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          Add-Type -AssemblyName System.Drawing
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap($screen.Width, $screen.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\id_screenshot.png")
          $response = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\id_screenshot.png" https://catbox.moe/user/api.php
          Write-Host "################################################"
          Write-Host "LINK DE LA CAPTURA: $response"
          Write-Host "################################################"

      - name: ðŸ”„ MANTENER VIVO
        shell: powershell
        run: |
          while($true) { Start-Sleep -Seconds 60 }
          
