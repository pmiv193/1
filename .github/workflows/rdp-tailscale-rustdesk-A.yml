name: WINDOWS_11_AUDIO_VBCABLE_V45
on: 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: üõ†Ô∏è 1. INSTALAR VB-CABLE V45
        shell: powershell
        run: |
          Write-Host "[*] Descargando VB-CABLE Pack 45..." -ForegroundColor Cyan
          $url = "https://download.vb-audio.com/Download_CABLE/VBCABLE_Driver_Pack45.zip"
          # Usamos -UserAgent para evitar que el servidor de VB-Audio bloquee la descarga
          Invoke-WebRequest -Uri $url -OutFile "vbcable.zip" -UserAgent "Mozilla/5.0"
          
          Write-Host "[*] Descomprimiendo archivos..." -ForegroundColor Yellow
          Expand-Archive -Path "vbcable.zip" -DestinationPath ".\vbcable" -Force
          
          Write-Host "[*] Instalando Driver de 64 bits (Silencioso)..." -ForegroundColor Cyan
          # /i = install, /s = silent
          Start-Process ".\vbcable\VBCABLE_Setup_x64.exe" -ArgumentList "/i /s" -Wait
          
          Write-Host "[+] Instalacion completada. Reiniciando servicios de audio..." -ForegroundColor Green
          net stop Audiosrv; net start Audiosrv

      - name: üîë 2. CONFIGURAR RUSTDESK
        shell: powershell
        run: |
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 15
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          
          $id = ""
          for ($i=0; $i -lt 12; $i++) {
              $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
              if ($id) { break }
              Write-Host "[!] Obteniendo ID..."
              Start-Sleep -Seconds 5
          }
          
          Write-Host "################################################" -ForegroundColor Yellow
          Write-Host "TU ID: $id" -ForegroundColor Green
          Write-Host "CLAVE: Bullet123" -ForegroundColor Green
          Write-Host "################################################" -ForegroundColor Yellow

      - name: üîÑ MANTENER VIVO
        shell: powershell
        run: |
          Write-Host "[!] El servidor de audio y RustDesk estan activos." -ForegroundColor Cyan
          while($true) { Start-Sleep -Seconds 60 }
          
