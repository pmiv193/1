name: WIN11_RTX5090_WINDOWS_APP
on: 
  workflow_dispatch:
    inputs:
      tailscale_key:
        description: 'Tu Tailscale Auth Key'
        required: true

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: üöÄ 1. SPOOFING RTX 5090 (PROVIDER NVIDIA)
        shell: powershell
        run: |
          Write-Host "[*] INYECTANDO HARDWARE RTX 5090..." -ForegroundColor Cyan
          $videoClass = "HKLM:\SYSTEM\CurrentControlSet\Control\Class\{4d36e968-e325-11ce-bfc1-08002be10318}"
          Get-ChildItem -Path $videoClass -ErrorAction SilentlyContinue | ForEach-Object {
              $desc = ($_ | Get-ItemProperty -Name "DriverDesc" -ErrorAction SilentlyContinue).DriverDesc
              if ($desc -match "Microsoft" -or $desc -match "Hyper-V" -or $desc -match "Display") {
                  # Nombre y Proveedor
                  Set-ItemProperty -Path $_.PSPath -Name "DriverDesc" -Value "NVIDIA GeForce RTX 5090" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "ProviderName" -Value "NVIDIA" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.ChipType" -Value "NVIDIA GeForce RTX 5090" -Force
                  Set-ItemProperty -Path $_.PSPath -Name "HardwareInformation.AdapterString" -Value "NVIDIA GeForce RTX 5090" -Force
                  
                  # 32GB VRAM (QWORD)
                  New-ItemProperty -Path $_.PSPath -Name "HardwareInformation.QwMemorySize" -Value 34359738368 -PropertyType QWord -Force
              }
          }
          # CPU Spoof
          Get-ChildItem -Path "HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor" | ForEach-Object {
              Set-ItemProperty -Path $_.PSPath -Name "ProcessorNameString" -Value "AMD Ryzen 9 7950X3D 16-Core Processor" -Force
          }

      - name: üåê 2. CONEXION TAILSCALE
        shell: powershell
        run: |
          curl.exe -L -o tailscale-setup.exe https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe
          Start-Process .\tailscale-setup.exe -ArgumentList "/quiet" -Wait
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey ${{ github.event.inputs.tailscale_key }}
          $tsIp = (& "C:\Program Files\Tailscale\tailscale.exe" ip -4)
          Write-Host "====================================" -ForegroundColor Yellow
          Write-Host "IP DE TAILSCALE: $tsIp" -ForegroundColor Green
          Write-Host "====================================" -ForegroundColor Yellow

      - name: üîë 3. CONFIGURAR RDP (PARA WINDOWS APP)
        shell: powershell
        run: |
          # Habilitar Escritorio Remoto
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 1
          
          # Establecer contrase√±a para el usuario actual (runneradmin)
          $Password = ConvertTo-SecureString "Bullet123!" -AsPlainText -Force
          Set-LocalUser -Name "runneradmin" -Password $Password
          Write-Host "[OK] RDP listo. User: runneradmin | Pass: Bullet123!" -ForegroundColor Green

      - name: üì∏ 4. EVIDENCIA CATBOX
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          $bitmap = New-Object System.Drawing.Bitmap([System.Windows.Forms.Screen]::PrimaryScreen.Bounds.Width, [System.Windows.Forms.Screen]::PrimaryScreen.Bounds.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen(0, 0, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\check.png")
          $link = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\check.png" https://catbox.moe/user/api.php
          Write-Host "SCREENSHOT: $link" -ForegroundColor Cyan

      - name: üîÑ LOOP INFINITO
        shell: powershell
        run: |
          while($true) { Start-Sleep -Seconds 60 }

